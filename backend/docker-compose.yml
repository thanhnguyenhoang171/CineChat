version: '3.8'

services:
  # # API Server
  # api:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #   container_name: netflix-api
  #   ports:
  #     - '3001:3001'
  #     - '9229:9229' # Debug port
  #   environment:
  #     - NODE_ENV=development
  #     - REDIS_HOST=redis
  #     - REDIS_PORT=6379
  #     - REDIS_PASSWORD=${REDIS_PASSWORD:-}
  #     - REDIS_DB=${REDIS_DB:-0}
  #   env_file:
  #     - .env.docker
  #   volumes:
  #     - ./src:/app/src
  #     - /app/node_modules
  #   depends_on:
  #     - redis
  #   networks:
  #     - netflix-network
  #   command: npm run start:dev
  #   healthcheck:
  #     test: ['CMD', 'curl', '-f', 'http://localhost:3001/health']
  #     interval: 30s
  #     timeout: 10s
  #     retries: 3

  # Redis
  redis:
    image: redis:7-alpine
    container_name: cinechat-redis
    ports:
      - '6380:6379'
    volumes:
      - redis_data:/data
      - ./redis.conf:/usr/local/etc/redis/redis.conf
    command: redis-server /usr/local/etc/redis/redis.conf --requirepass ""
    networks:
      - cinechat-network
    healthcheck:
      test: ['CMD', 'redis-cli', '-p', '6379', 'ping']
      interval: 10s
      timeout: 5s
      retries: 5

  # Redis Commander (GUI)
  redis-commander:
    image: rediscommander/redis-commander:latest
    container_name: redis-commander
    ports:
      - '8081:8081'
    environment:
      - REDIS_HOSTS=local:redis:6379
      - HTTP_USER=admin
      - HTTP_PASSWORD=admin123
    depends_on:
      - redis
    networks:
      - cinechat-network

volumes:
  redis_data:

networks:
  cinechat-network:
    driver: bridge
